version: '3.8'

services:
  # 1. 您的 PikPak Bot
  pikpakbot:
    build: .
    container_name: pikpak_bot
    restart: unless-stopped
    environment:
      - TZ=Asia/Taipei
    volumes:
      - .:/code                # 將當前程式碼映射進去 (包含 config.py)
      - ./downloads:/downloads # 下載路徑映射 (宿主機:容器內)
    ports:
      - "5000:5000"            # Web UI 端口
    depends_on:
      - aria2
    # 網路設定：確保 bot 可以用 'aria2' 這個名字找到下載器
    networks:
      - pikpak_net

  # 2. Aria2 下載器 (使用 P3TERX 完美配置版)
  aria2:
    image: p3terx/aria2-pro
    container_name: pikpak_aria2
    restart: unless-stopped
    environment:
      - RPC_SECRET=pikpak_secret  # 對應 config.py 的 ARIA2_SECRET
      - RPC_PORT=6800
      - LISTEN_PORT=6888
      - DISK_CACHE=64M
      - IPV6_MODE=false
    volumes:
      - ./aria2-config:/config    # Aria2 設定檔存放處
      - ./downloads:/downloads    # 下載路徑，必須跟 bot 的映射一致！
    ports:
      - "6800:6800"  # RPC 端口
      - "6888:6888"  # BT 監聽端口
      - "6888:6888/udp"
    networks:
      - pikpak_net

  # 3. AriaNg (網頁版管理介面，選用)
  ariang:
    image: p3terx/ariang
    container_name: pikpak_ariang
    restart: unless-stopped
    ports:
      - "6880:6880" # 訪問 http://IP:6880 管理 Aria2
    networks:
      - pikpak_net

networks:
  pikpak_net:
    driver: bridge